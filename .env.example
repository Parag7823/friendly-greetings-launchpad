# Finley AI Backend Environment Variables
# Copy this file to .env and fill in your actual values

# ============================================================================
# REQUIRED - Core Services
# ============================================================================

# Supabase Configuration
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your-service-role-key-here
# Alternative names (for compatibility):
# SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here

# OpenAI Configuration
OPENAI_API_KEY=your-openai-api-key-here

# ============================================================================
# OPTIONAL - Performance Optimizations
# ============================================================================

# Redis Configuration (Optional - for enhanced performance)
# If not provided, system will use database-only job queue
REDIS_URL=redis://localhost:6379

# Alternative Redis configurations:
# REDIS_URL=redis://username:password@hostname:port/database
# REDIS_URL=rediss://username:password@hostname:port/database  # SSL

# ============================================================================
# OPTIONAL - Performance Tuning
# ============================================================================

# Job Processing Configuration
MAX_CONCURRENT_JOBS=10
REDIS_MAX_CONNECTIONS=20
DATABASE_POOL_SIZE=20

# Retry Configuration
DEFAULT_MAX_RETRIES=3
DEFAULT_RETRY_BACKOFF_FACTOR=2.0
DEFAULT_MAX_RETRY_DELAY=300

# File Processing Configuration
MAX_FILE_SIZE_MB=500
MAX_BATCH_SIZE=100

# ============================================================================
# OPTIONAL - Monitoring and Logging
# ============================================================================

# Logging Level
LOG_LEVEL=INFO

# Performance Monitoring
ENABLE_PERFORMANCE_METRICS=true
METRICS_RETENTION_DAYS=30

# Health Check Configuration
HEALTH_CHECK_INTERVAL_SECONDS=60

# ============================================================================
# DEVELOPMENT - Frontend Integration
# ============================================================================

# Frontend URLs (for CORS)
FRONTEND_URL=http://localhost:3000
VITE_FRONTEND_URL=http://localhost:5173

# Frontend API Configuration
# Override the default API URL (defaults to production if not set)
VITE_API_URL=http://localhost:8000

# Frontend Feature Flags
VITE_ENABLE_ANALYTICS=false
VITE_DEBUG_LOGS=true

# ============================================================================
# PRODUCTION - Deployment Configuration
# ============================================================================

# Server Configuration
HOST=0.0.0.0
PORT=8000

# Security
ALLOWED_HOSTS=localhost,127.0.0.1,your-domain.com
CORS_ORIGINS=https://your-frontend-domain.com

# Database Connection Pool
DB_POOL_MIN_SIZE=5
DB_POOL_MAX_SIZE=20
DB_POOL_TIMEOUT=30

# ============================================================================
# OPTIONAL - Advanced Features
# ============================================================================

# OCR Configuration (for image processing)
TESSERACT_CMD=/usr/bin/tesseract

# PDF Processing
TABULA_JAR_PATH=/path/to/tabula.jar

# File Storage
TEMP_DIR=/tmp/finley-processing
MAX_TEMP_FILE_AGE_HOURS=24

# Duplicate Detection Configuration
DUPLICATE_CACHE_TTL=3600
SIMILARITY_THRESHOLD=0.85
ENABLE_DUPLICATE_DETECTION=true

# ============================================================================
# PHASE 12-14 - OAuth Connectors, Background Jobs & Monitoring (NEW)
# ============================================================================

# OAuth Connectors (Nango.dev) - REQUIRED for Phase 12
# Sign up at https://nango.dev to get these credentials
NANGO_SECRET_KEY=your-nango-secret-key-here
NANGO_BASE_URL=https://api.nango.dev
NANGO_WEBHOOK_SECRET=your-nango-webhook-secret-here

# OAuth Integration IDs (configure these in Nango dashboard)
NANGO_GMAIL_INTEGRATION_ID=gmail
NANGO_DROPBOX_INTEGRATION_ID=dropbox
NANGO_GOOGLE_DRIVE_INTEGRATION_ID=google-drive
NANGO_ZOHO_MAIL_INTEGRATION_ID=zoho-mail
NANGO_QUICKBOOKS_INTEGRATION_ID=quickbooks
NANGO_XERO_INTEGRATION_ID=xero

# Background Job Processing (ARQ + Celery) - REQUIRED for Phase 12
# Use the same Redis URL for all background job systems
ARQ_REDIS_URL=redis://localhost:6379
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# For Render.com deployment, use internal Redis URL:
# ARQ_REDIS_URL=redis://red-xxxxx:6379
# CELERY_BROKER_URL=redis://red-xxxxx:6379/0
# CELERY_RESULT_BACKEND=redis://red-xxxxx:6379/0

# Error Tracking & Monitoring (Sentry) - RECOMMENDED for Phase 14
# Sign up at https://sentry.io to get DSN
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1
ENVIRONMENT=production
APP_VERSION=1.0.0

# ============================================================================
# PHASE 8-11 - Relationship Detection & Performance
# ============================================================================

# Relationship Detection Configuration
# Cross-file relationship detection limits
RELATIONSHIP_MAX_SOURCE_EVENTS=100      # Max source events to process (default: 100)
RELATIONSHIP_MAX_TARGET_EVENTS=100      # Max target events to process (default: 100)
RELATIONSHIP_BATCH_SIZE=50              # Batch size for processing (default: 50)

# Within-file relationship detection
RELATIONSHIP_WITHIN_FILE_WINDOW=20      # Window size for sequential events (default: 20)

# AI Cache Configuration
AI_CACHE_MAX_SIZE=10000                 # Maximum cache entries (default: 10000)
AI_CACHE_TTL_HOURS=24                   # Cache TTL in hours (default: 24)
AI_CACHE_COST_PER_1K=0.002             # Cost per 1K tokens (default: 0.002)

# Batch Optimizer Configuration
BATCH_OPTIMIZER_SIZE=100                # Batch size for database operations (default: 100)

# Streaming Processor Configuration
STREAMING_CHUNK_SIZE=1000               # Rows per chunk (default: 1000)
STREAMING_MEMORY_LIMIT_MB=800           # Memory limit in MB (default: 800)
STREAMING_MAX_FILE_SIZE_GB=5            # Max file size in GB (default: 5)
STREAMING_TEMP_DIR=/tmp/streaming       # Temp directory for streaming
STREAMING_ENABLE_COMPRESSION=true       # Enable compression (default: true)
STREAMING_PROGRESS_INTERVAL=100         # Chunks between progress updates (default: 100)

# ============================================================================
# NOTES
# ============================================================================

# 1. REQUIRED variables must be set for the application to work
# 2. OPTIONAL variables have sensible defaults if not provided
# 3. Redis is optional but recommended for production deployments
# 4. Performance tuning variables can be adjusted based on your server specs
# 5. All URLs should include the protocol (http:// or https://)
# 6. For production, use strong, unique values for all keys
# 7. Never commit your actual .env file to version control

# ============================================================================
# QUICK START
# ============================================================================

# For local development, you only need:
# 1. SUPABASE_URL
# 2. SUPABASE_SERVICE_KEY (or SUPABASE_SERVICE_ROLE_KEY)
# 3. OPENAI_API_KEY

# For production, additionally set:
# 4. REDIS_URL (recommended)
# 5. CORS_ORIGINS
# 6. ALLOWED_HOSTS

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Universal Finance Schema v1",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "user_id": { "type": ["string", "null"], "format": "uuid" },
    "record_type": { "type": ["string", "null"], "enum": [
      "invoice", "payment", "expense", "revenue", "transfer", "journal", "other", null
    ]},
    "amount": {
      "type": ["object", "null"],
      "properties": {
        "value": { "type": ["number", "string", "null"] },
        "currency": { "type": ["string", "null"], "minLength": 1 }
      },
      "additionalProperties": true
    },
    "dates": {
      "type": ["object", "null"],
      "properties": {
        "issued": { "type": ["string", "null"], "format": "date-time" },
        "posted": { "type": ["string", "null"], "format": "date-time" },
        "due": { "type": ["string", "null"], "format": "date-time" }
      },
      "additionalProperties": true
    },
    "identifiers": {
      "type": ["object", "null"],
      "properties": {
        "invoice_id": { "type": ["string", "null"] },
        "payment_id": { "type": ["string", "null"] },
        "external_id": { "type": ["string", "null"] },
        "reference": { "type": ["string", "null"] }
      },
      "additionalProperties": true
    },
    "parties": {
      "type": ["object", "null"],
      "properties": {
        "payer": { "$ref": "#/definitions/party" },
        "payee": { "$ref": "#/definitions/party" },
        "customer": { "$ref": "#/definitions/party" },
        "vendor": { "$ref": "#/definitions/party" }
      },
      "additionalProperties": true
    },
    "line_items": {
      "type": ["array", "null"],
      "items": { "$ref": "#/definitions/line_item" }
    },
    "classification": {
      "type": ["object", "null"],
      "properties": {
        "document_type": { "type": ["string", "null"] },
        "platform": { "type": ["string", "null"] },
        "confidence": { "type": ["number", "string", "null"] },
        "methods": {
          "type": ["array", "null"],
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    },
    "source": {
      "type": ["object", "null"],
      "properties": {
        "platform": { "type": ["string", "null"] },
        "filename": { "type": ["string", "null"] },
        "row_index": { "type": ["integer", "string", "null"] },
        "event_id": { "type": ["string", "null"] },
        "file_id": { "type": ["string", "null"] },
        "ingest_ts": { "type": ["string", "null"], "format": "date-time" }
      },
      "additionalProperties": true
    },
    "context": {
      "type": ["object", "null"],
      "properties": {
        "description": { "type": ["string", "null"] },
        "memo": { "type": ["string", "null"] },
        "notes": { "type": ["string", "null"] }
      },
      "additionalProperties": true
    },
    "taxes": {
      "type": ["object", "null"],
      "properties": {
        "tax_code": { "type": ["string", "null"] },
        "tax_amount": { "type": ["number", "string", "null"] }
      },
      "additionalProperties": true
    },
    "metadata": { "type": ["object", "null"], "additionalProperties": true }
  },
  "definitions": {
    "party": {
      "type": ["object", "null"],
      "properties": {
        "name": { "type": ["string", "null"] },
        "party_id": { "type": ["string", "null"] },
        "identifiers": { "type": ["object", "null"], "additionalProperties": true }
      },
      "additionalProperties": true
    },
    "line_item": {
      "type": "object",
      "properties": {
        "description": { "type": ["string", "null"] },
        "quantity": { "type": ["number", "string", "null"] },
        "unit_price": { "type": ["number", "string", "null"] },
        "amount": { "type": ["number", "string", "null"] },
        "tax": { "type": ["number", "string", "null"] }
      },
      "additionalProperties": true
    }
  }
}
